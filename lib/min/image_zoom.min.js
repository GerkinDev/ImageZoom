var ImageZoom=function(e,t){function o(e,t,o){e.addEventListener?e.addEventListener(t,o):e.attachEvent(t,o)}function a(e,t,o){e.addEventListener?e.removeEventListener(t,o):e.detachEvent(t,o)}function r(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function i(e,t){for(var o in t)try{t[o].constructor==Object?e[o]=i(e[o],t[o]):e[o]=t[o]}catch(a){e[o]=t[o]}return e}function n(){clearInterval(w)
var e="opacity "+p.opts.appearDuration+"s, top 0.1s, left 0.1s"
p.zoomedImage.style.webkitTransition=e,p.zoomedImage.style.mozTransition=e,p.zoomedImage.style.transition=e,o(window,"resize",p.recalculatePositions),p.recalculatePositions()&&p.enable()}function s(){g.classList.add("active")}function m(){g.classList.remove("active")}function d(e){s()
for(var t=["x","y"],o={},a=0;2>a;a++){var r,i=t[a],n="offset"+i.toUpperCase()
r=e[n]<p.opts.deadarea*b[i]?0:e[n]>(1-p.opts.deadarea)*b[i]?100:(e[n]-c[i])/z[i]*100,o[i]=r*I[i]/100}p.zoomedImage.style.top=-o.y+"px",p.zoomedImage.style.left=-o.x+"px"}var l,p=this
jQuery&&e instanceof jQuery?l=e[0]:("string"==typeof e||e instanceof String)&&(l=document.querySelector(e))
var g,u,c,f,h,y,v,I,z,b,x=null
if(Object.defineProperties(this,{proportion:{get:function(){return h}}}),p.opts=i({maxZoom:2,deadarea:.1,appearDuration:.5,target:null,imageUrl:null,backgroundImageColor:null,forceNaturalProportions:!0},t),p.opts.target&&"object"==typeof p.opts.target)if(jQuery&&p.opts.target instanceof jQuery)p.opts.target=p.opts.target[0]
else if(!r(p.opts.target)){var L=p.opts.target
L.width||(L.width=l.width),L.height||(L.height=l.height),L.width&&L.height&&(L.left||L.right||L.top||L.bottom)?(x=L,p.opts.target=document.createElement("div"),p.opts.target.classList.add("zoomable"),l.parentNode.appendChild(p.opts.target)):(console.warn("Missing position attributes for Zoomable Image target: ",L),p.opts.target=null)}g=p.opts.target,p.zoomedImage=l.cloneNode(!0),p.zoomedImage.classList.add("zoomed"),p.zoomedImage.removeAttribute("src"),p.zoomedImage.removeAttribute("height"),p.zoomedImage.removeAttribute("width"),p.zoomedImage.removeAttribute("srcset"),p.zoomedImage.removeAttribute("sizes"),p.zoomedImage.removeAttribute("id"),p.zoomedImage.removeAttribute("style"),null!=p.opts.imageUrl?p.zoomedImage.setAttribute("src",p.opts.imageUrl):p.zoomedImage.setAttribute("src",l.getAttribute("data-fullwidth-src")?l.getAttribute("data-fullwidth-src"):l.getAttribute("src")),null!=p.opts.backgroundImageColor&&(p.zoomedImage.style.background=p.opts.backgroundImageColor),null==g?(g=document.createElement("div"),g.classList.add("zoomable"),g.classList.add("zoomableInPlace"),g.appendChild(p.zoomedImage),l.parentNode.appendChild(g),v=!0):(g.classList.add("zoomable"),g.appendChild(p.zoomedImage),v=!1)
var w=null
return setTimeout(function(){p.zoomedImage.complete&&l.complete&&0!=p.zoomedImage.naturalWidth&&0!=p.zoomedImage.naturalHeight?n():w=setInterval(function(){p.zoomedImage.complete&&l.complete&&0!=p.zoomedImage.naturalWidth&&0!=p.zoomedImage.naturalHeight&&(clearInterval(w),n())},50)},50),this.enable=function(){return o(l,"mousemove",d),o(l,"mouseenter",s),o(l,"mouseleave",m),p},this.disable=function(){return a(l,"mousemove",d),a(l,"mouseenter",s),a(l,"mouseleave",m),p},this.recalculatePositions=function(){if(m(),null!=x){var e={height:x.height+"px",width:x.width+"px",top:l.offsetTop+"px",left:l.offsetLeft+"px",position:"absolute"}
x.top&&(e.top=l.offsetTop-(x.height+x.top)+"px"),x.bottom&&(e.top=l.offsetTop+(l.clientHeight+x.bottom)+"px"),x.left&&(e.left=l.offsetLeft-(x.width+x.left)+"px"),x.right&&(e.left=l.offsetLeft+(l.clientWidth+x.right)+"px")
for(var t in e)p.opts.target.style[t]=e[t]}y={x:l.clientWidth,y:l.clientHeight},z={x:y.x*(1-2*p.opts.deadarea),y:y.y*(1-2*p.opts.deadarea)},v&&(g.style.top=l.offsetTop+"px",g.style.left=l.offsetLeft+"px",g.style.width=y.x+"px",g.style.height=y.y+"px")
var o={x:p.zoomedImage.naturalWidth/y.x,y:p.zoomedImage.naturalHeight/y.y}
if(o.x<1||o.y<1)return console.warn("Zoom on stretched image",p.zoomedImage,{original:y,natural:{x:p.zoomedImage.naturalWidth,y:p.zoomedImage.naturalHeight}}),p.disable(),!1
var a=Math.min(o.x,o.y)
return h=Math.min(a,p.opts.maxZoom),f=h-1,b=p.opts.forceNaturalProportions?{x:p.zoomedImage.naturalWidth/a,y:p.zoomedImage.naturalHeight/a}:{x:y.x,y:y.y},p.zoomedImage.style.width=b.x*h+"px",p.zoomedImage.style.height=b.y*h+"px",I={x:b.x*h-g.clientWidth,y:b.y*h-g.clientHeight},c={x:p.opts.deadarea*b.x,y:p.opts.deadarea*b.y},u=f/(1-2*p.opts.deadarea),!0},this["delete"]=function(){p.disable(),p.zoomedImage.parentNode.removeChild(p.zoomedImage),g.classList.contains("active")?g.classList.remove("active")&&setTimeout(function(){g.parentNode.removeChild(g)},100*p.opts.appearDuration):g.parentNode.removeChild(g)},p}
